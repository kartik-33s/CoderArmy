<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Coder Army</title>

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="login-body">
    <main class="auth-wrapper">
      <section class="auth-card">
        <h1 class="auth-title">Welcome!</h1>
        <p class="auth-subtitle">Sign in with Google to continue</p>

        <div class="permission-box">
          <h3 class="permission-title">CoderArmy needs permission to:</h3>
          <ul class="permission-list">
            <li>
              <i class="fas fa-youtube"></i>
              See, edit, and delete your YouTube videos, ratings, comments
            </li>
            <li>
              <i class="fas fa-list-check"></i>
              Manage your YouTube account, playlists and subscriptions
            </li>
          </ul>
          <p class="permission-note">
            Make sure you trust CoderArmy before granting these permissions.
          </p>
        </div>

        <a id="googleSignInBtn" class="google-button" href="#" data-client-id="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com" data-redirect="index.html">
          <img class="google-icon" alt="G" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" />
          <span>Continue with Google</span>
          <i class="fas fa-arrow-right"></i>
        </a>

        <p class="terms-text">
          By signing in, you agree to our
          <a href="#" class="link">Terms of Service</a> and
          <a href="#" class="link">Privacy Policy</a>
        </p>

        <a class="back-home" href="index.html"><i class="fas fa-arrow-left"></i> Back to Home</a>
      </section>
    </main>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      (function () {
        const btn = document.getElementById('googleSignInBtn');
        if (!btn) return;

        const CLIENT_ID = btn.dataset.clientId;
        const REDIRECT = btn.dataset.redirect || 'index.html';
        const SCOPES = [
          'https://www.googleapis.com/auth/youtube',
          'https://www.googleapis.com/auth/youtube.readonly',
          'https://www.googleapis.com/auth/youtube.force-ssl'
        ].join(' ');

        let tokenClient = null;

        function initClient() {
          if (!CLIENT_ID || CLIENT_ID.includes('YOUR_GOOGLE_CLIENT_ID')) {
            alert('Please set your Google OAuth Client ID in login.html (data-client-id).');
            return null;
          }
          if (!tokenClient && window.google && google.accounts && google.accounts.oauth2) {
            tokenClient = google.accounts.oauth2.initTokenClient({
              client_id: CLIENT_ID,
              scope: SCOPES,
              prompt: 'consent',
              callback: (resp) => {
                // Do NOT log the access token. Treat it as a secret.
                if (resp && resp.access_token) {
                  sessionStorage.setItem('ga_signed_in', '1');
                  // Optionally, store token in memory only; avoid persisting if not needed.
                  // Redirect after brief confirmation.
                  setTimeout(() => { window.location.href = REDIRECT; }, 600);
                }
              }
            });
          }
          return tokenClient;
        }

        btn.addEventListener('click', function (e) {
          e.preventDefault();
          const client = initClient();
          if (!client) return;
          client.requestAccessToken();
        });
      })();
    </script>
  </body>
</html>
